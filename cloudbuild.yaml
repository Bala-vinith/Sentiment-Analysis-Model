steps:
  # Step 1: Clone the GitHub repository
  - name: 'gcr.io/cloud-builders/git'
    args: ['clone', 'https://github.com/Bala-vinith/gcp-ml-model.git', '.']

  # Step 2: Build the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - 'gcr.io/$PROJECT_ID/sentiment-analysis-model:$COMMIT_SHA'
      - '.'

  # Step 3: Tag the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'tag'
      - 'gcr.io/$PROJECT_ID/sentiment-analysis-model:$COMMIT_SHA'
      - 'gcr.io/$PROJECT_ID/sentiment-analysis-model:latest'

  # Step 4: Push the Docker image to Artifact Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/sentiment-analysis-model:$COMMIT_SHA']

  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/sentiment-analysis-model:latest']

options:
  # Set the substitutions for the image and tag
  substitutions:
    _ARTIFACT_REGISTRY_LOCATION: 'asia-south1'
    _ARTIFACT_REGISTRY_REPOSITORY: 'sentiment-analysis-model'
    _IMAGE_NAME: 'sentiment-analysis-model'
    _TAG_NAME: '$COMMIT_SHA'
